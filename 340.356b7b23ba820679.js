"use strict";(self.webpackChunkTerraForm=self.webpackChunkTerraForm||[]).push([[340],{9340:(k,g,l)=>{l.r(g),l.d(g,{PaymentsModule:()=>L});var c=l(817),d=l(6603),b=l(7964),y=l.n(b),e=l(3333),T=l(162),u=l(5556);let f=(()=>{class a extends T.U{getPayments(){return this.prepareTokenHeader(),this.http.get(u.N.routerBase+"/payments/list",{headers:this.headers})}addPayment(t){return this.prepareTokenHeader(),this.http.post(u.N.routerBase+"/payments/new",t,{headers:this.headers})}getPaymentsByUuid(t){return this.prepareTokenHeader(),this.http.get(u.N.routerBase+"/payments/get/"+t,{headers:this.headers})}updPayment(t){return this.prepareTokenHeader(),this.http.post(u.N.routerBase+"/payments/upd",t,{headers:this.headers})}delPayment(t){return this.prepareTokenHeader(),this.http.post(u.N.routerBase+"/payments/delete",t,{headers:this.headers})}getAnalytics(){return this.prepareTokenHeader(),this.http.get(u.N.routerBase+"/payments/analytics",{headers:this.headers})}getResources(){return this.prepareTokenHeader(),this.http.get(u.N.routerBase+"/payments/resources",{headers:this.headers})}}return a.\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(a)))(n||a)}}(),a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var _=l(5391),v=l(2306);let P=(()=>{class a{constructor(t,n,o){this._service=t,this.router=n,this.route=o,this.Payments=[],this.showLoader=!0,this.metrics={completed:0,electronic:0,cash:0,pending:0}}ngOnInit(){this.getList()}getList(){this.showLoader=!0,this._service.getPayments().subscribe(t=>{console.log(t),this.Payments=t,this.showLoader=!1}),this.loadAnalytics()}loadAnalytics(){this.showLoader=!0,this._service.getAnalytics().subscribe(t=>{console.log(t),this.metrics=t,this.showLoader=!1})}deletePayment(t){y().fire({title:"Cuidado",text:"\xbfDesea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar!",cancelButtonText:"Cancelar"}).then(n=>{console.log(n),this.showLoader=!0,n.isConfirmed?this._service.delPayment({uuid:t.uuid}).subscribe(o=>{this.showLoader=!1,this.getList()}):this.showLoader=!1})}goToAdd(){this.router.navigate(["admin/payments/new"])}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(f),e.Y36(d.F0),e.Y36(d.gz))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-payments-list"]],decls:64,vars:7,consts:[[1,"row","page-titles","mx-0"],[1,"col-sm-6","p-md-0"],[1,"welcome-text"],[1,"mb-1"],[1,"col-sm-6","p-md-0","justify-content-sm-end","mt-2","mt-sm-0","d-flex"],["type","button",1,"btn","btn-primary","btn-sl-sm","mr-3",3,"click"],[1,"mr-2"],[1,"fa","fa-plus"],[1,"row"],[1,"col-lg-3","col-sm-6"],[1,"card"],[1,"stat-widget-two","card-body"],[1,"stat-content"],[1,"stat-text"],[1,"stat-digit"],[1,"fa","fa-money"],[1,"progress"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-success","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-primary","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-warning","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-danger","w-100"],[1,"col-12"],[1,"card-body"],[2,"width","100%","height","100%"],[3,"rowData","idTable","deleteRow"],[3,"showLoader"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),e._uU(4,"Pagos"),e.qZA(),e.TgZ(5,"p",3),e._uU(6,"Pagos Registrados"),e.qZA()()(),e.TgZ(7,"div",4)(8,"button",5),e.NdJ("click",function(){return n.goToAdd()}),e.TgZ(9,"span",6),e._UZ(10,"i",7),e.qZA(),e._uU(11," Nuevo registro"),e.qZA()()(),e.TgZ(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"div",12)(17,"div",13),e._uU(18,"Pagos completos"),e.qZA(),e.TgZ(19,"div",14),e._UZ(20,"i",15),e._uU(21),e.qZA()(),e.TgZ(22,"div",16),e._UZ(23,"div",17),e.qZA()()()(),e.TgZ(24,"div",9)(25,"div",10)(26,"div",11)(27,"div",12)(28,"div",13),e._uU(29,"Pagos Electronicos"),e.qZA(),e.TgZ(30,"div",14),e._UZ(31,"i",15),e._uU(32),e.qZA()(),e.TgZ(33,"div",16),e._UZ(34,"div",18),e.qZA()()()(),e.TgZ(35,"div",9)(36,"div",10)(37,"div",11)(38,"div",12)(39,"div",13),e._uU(40,"Pagos en Efectivo"),e.qZA(),e.TgZ(41,"div",14),e._UZ(42,"i",15),e._uU(43),e.qZA()(),e.TgZ(44,"div",16),e._UZ(45,"div",19),e.qZA()()()(),e.TgZ(46,"div",9)(47,"div",10)(48,"div",11)(49,"div",12)(50,"div",13),e._uU(51,"Pagos pendientes"),e.qZA(),e.TgZ(52,"div",14),e._UZ(53,"i",15),e._uU(54),e.qZA()(),e.TgZ(55,"div",16),e._UZ(56,"div",20),e.qZA()()()()(),e.TgZ(57,"div",8)(58,"div",21)(59,"div",10)(60,"div",22)(61,"div",23)(62,"app-table-terra",24),e.NdJ("deleteRow",function(i){return n.deletePayment(i)}),e.qZA()()()()()(),e._UZ(63,"app-loader",25)),2&t&&(e.xp6(21),e.Oqu(n.metrics.completed),e.xp6(11),e.Oqu(n.metrics.electronic),e.xp6(11),e.hij(" ",n.metrics.cash,""),e.xp6(11),e.Oqu(n.metrics.pending),e.xp6(8),e.Q6J("rowData",n.Payments)("idTable",2),e.xp6(1),e.Q6J("showLoader",n.showLoader))},dependencies:[_.x,v.R]}),a})();var m=l(7036),r=l(8765),U=l(8617);function C(a,s){if(1&a){const t=e.EpF();e.TgZ(0,"button",49),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.deletePayment())}),e.TgZ(1,"span",50),e._UZ(2,"i",51),e.qZA(),e._uU(3," Eliminar"),e.qZA()}}function w(a,s){if(1&a&&(e.TgZ(0,"span",52),e._uU(1),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Oqu(t.paymentDetail.length)}}function A(a,s){if(1&a&&(e.TgZ(0,"li",53)(1,"div")(2,"h6",54),e._uU(3),e.qZA(),e.TgZ(4,"small",15),e._uU(5),e.qZA()(),e.TgZ(6,"span",15),e._uU(7),e.qZA()()),2&a){const t=s.$implicit;e.xp6(3),e.Oqu(t.Name),e.xp6(2),e.Oqu(t.Description),e.xp6(2),e.Oqu(t.Amount)}}function q(a,s){if(1&a&&(e.TgZ(0,"option",55),e._uU(1),e.qZA()),2&a){const t=s.$implicit;e.Q6J("value",t.UUID),e.xp6(1),e.Oqu(t.Name)}}function D(a,s){if(1&a){const t=e.EpF();e.TgZ(0,"div",56)(1,"input",57),e.NdJ("change",function(o){const p=e.CHM(t).$implicit,h=e.oxw();return e.KtG(h.onCheckChange(o,p))}),e.qZA(),e.TgZ(2,"label",58),e._uU(3),e.qZA()()}if(2&a){const t=s.$implicit,n=e.oxw();e.xp6(1),e.s9C("id",t.UUID),e.Q6J("checked",n.validateCheck(t)),e.xp6(1),e.s9C("for",t.UUID),e.xp6(1),e.Oqu(t.Name)}}function x(a,s){1&a&&(e.TgZ(0,"div",7)(1,"div",59)(2,"label",60),e._uU(3,"Referencia"),e.qZA(),e._UZ(4,"input",61),e.TgZ(5,"small",15),e._uU(6,"Agregar referencia"),e.qZA(),e.TgZ(7,"div",28),e._uU(8," reference is required "),e.qZA()()())}let Z=(()=>{class a{constructor(t,n,o,i){this._service=t,this.router=n,this.route=o,this.alert=i,this.formHasBeenSave=!1,this.showLoader=!0,this.disableForm=!1,this.uuid=null,this.viewType="add",this.btnlabel="Agregar",this.studentsSelect=[],this.paymentDetail=[],this.products=[],this.totalUSD=0,this.PaymentDescription="",this.productsOnPayments=[],this.paymenType="",this.createForm(),this.subscribeChangeForm(),this.loadStudentsSelect()}ngOnInit(){this.showLoader=!0,this.route.params.subscribe(t=>{this.uuid=t.uuid,void 0!==this.uuid?(this.showLoader=!1,this.viewType="edit",this.loadPayment(),this.btnlabel="Guardar"):this.showLoader=!1})}loadStudentsSelect(){this.showLoader=!0,this._service.getResources().subscribe(t=>{console.log(t);let n=t;this.studentsSelect=n.students,this.products=n.products,this.showLoader=!1})}subscribeChangeForm(){this.formPayment.valueChanges.subscribe(t=>{this.formPayment.pristine||(this.formHasBeenSave=!1)})}loadPayment(){this.showLoader=!0,this._service.getPaymentsByUuid(this.uuid).subscribe(t=>{console.log(t),this.setFormPayment(t),this.showLoader=!1})}setFormPayment(t){this.formPayment.get("Amount").patchValue(t.Amount),this.formPayment.get("Currency").patchValue(t.Currency),this.formPayment.get("Student").patchValue(t.Student.UUID),this.formPayment.get("PaymentDate").patchValue(t.PaymentDate),this.formPayment.get("Observation").patchValue(t.Observation),this.formPayment.get("UUID").patchValue(t.UUID),this.formPayment.get("PaymentType").patchValue(t.PaymentType),this.formPayment.get("Reference").patchValue(t.Reference),this.formPayment.get("Create_at").patchValue(t.Create_at),this.formPayment.get("Description").patchValue(t.Description),this.formPayment.get("Status").patchValue(t.Status),this.totalUSD=t.Amount,this.paymentDetail=t.products}createForm(){this.formPayment=new r.cw({Amount:new r.NI(0,[r.kI.required]),Currency:new r.NI(2),Student:new r.NI("",[r.kI.required]),PaymentDate:new r.NI(""),Observation:new r.NI(""),UUID:new r.NI(""),PaymentType:new r.NI("",[r.kI.required]),Reference:new r.NI(""),Create_at:new r.NI(""),Description:new r.NI("",[r.kI.required]),Status:new r.NI(1,[r.kI.required])})}sendForm(){var t=this;return(0,m.Z)(function*(){if(t.formHasBeenSave=!0,t.disableForm=!0,t.formPayment.valid){t.showLoader=!0;let n=t.formPayment.value;console.log(t.viewType),"add"==t.viewType?t._service.addPayment({payment:n,products:t.paymentDetail}).subscribe(function(){var o=(0,m.Z)(function*(i){t.alert.success("Registro Creado","Se ha creado el registro"),t.showLoader=!1,t.goBack()});return function(i){return o.apply(this,arguments)}}(),o=>{console.log(o),t.disableForm=!1,t.showLoader=!1}):(t.alert.success("Registro Actualizado","Se ha actualizado el registro"),t._service.updPayment({payment:n,products:t.paymentDetail}).subscribe(function(){var o=(0,m.Z)(function*(i){console.log(i),t.showLoader=!1});return function(i){return o.apply(this,arguments)}}(),o=>{console.log(o),t.disableForm=!1,t.showLoader=!1}))}else t.alert.warning("Campos invalidos","Verifique los campos marcados")})()}deletePayment(){y().fire({title:"Cuidado",text:"\xbfDesea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar!",cancelButtonText:"Cancelar"}).then(t=>{console.log(t),t.isConfirmed&&this._service.delPayment({uuid:this.uuid}).subscribe(n=>{this.goBack()})})}goBack(){this.router.navigate(["admin/payments"])}validateCheck(t){let n=null;return n=this.paymentDetail.find(o=>o.UUID==t.UUID),!!n}onCheckChange(t,n){console.log(n),t.target.checked?this.paymentDetail.push(n):this.paymentDetail=this.paymentDetail.filter(o=>o.UUID!=n.UUID),this.totalUSD=this.paymentDetail.reduce((o,i)=>o+i.Amount,0),this.formPayment.get("Amount").patchValue(this.totalUSD),this.PaymentDescription=this.paymentDetail.reduce((o,i)=>o+" | "+i.Description,""),this.PaymentDescription=this.PaymentDescription.slice(0,99),this.formPayment.get("Description").patchValue(this.PaymentDescription)}onRadioChange(t){this.paymenType=t.target.value}validatorOfInput(t){let i,n=this.formPayment.get(t);if(!(n.touched&&n.invalid||this.formHasBeenSave&&n.invalid))return"";if(n.errors.required)return i="Campo Requerido.",i;if(n.errors.pattern)return i="El formato no es valido",i;if(n.errors.minlength)return i=`Debe contener al menos ${n.errors.minlength.requiredLength} caracteres`,i;if(n.errors.maxlength){let h=n.value.substring(0,n.value.length-1);n.patchValue(h)}}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(f),e.Y36(d.F0),e.Y36(d.gz),e.Y36(U.c))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-payment-crud"]],decls:89,vars:14,consts:[[1,"row","page-titles","mx-0"],[1,"col-sm-6","p-md-0"],[1,"welcome-text"],[1,"mb-1"],[1,"col-sm-6","p-md-0","justify-content-sm-end","mt-2","mt-sm-0","d-flex"],["class","btn btn-danger btn-sl-sm mr-3","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-warning",3,"click"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body","row"],[1,"col-md-4","order-md-2","mb-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"text-muted"],["class","badge badge-secondary badge-pill",4,"ngIf"],[1,"paymentDetailContainer"],[1,"list-group","mb-3"],["class","list-group-item d-flex justify-content-between lh-condensed",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between"],[1,"col-md-8","order-md-1"],["novalidate","",1,"needs-validation",3,"formGroup"],[1,"mb-3"],["for","Student"],["id","Student","required","","formControlName","Student",1,"custom-select","d-block","w-100"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"invalid-feedback"],["id","Student","required","","formControlName","Status",1,"custom-select","d-block","w-100"],["value","1"],["value","2"],["for","PaymentDate"],["type","date","id","PaymentDate","formControlName","PaymentDate","placeholder","dd/mm/yyyy",1,"form-control"],[1,"mb-4"],["class","custom-control custom-checkbox",4,"ngFor","ngForOf"],[1,"d-block","my-3"],[1,"custom-control","custom-radio"],["formControlName","PaymentType","id","credit","name","PaymentType","type","radio","checked","","value","POS","required","",1,"custom-control-input",3,"change"],["for","credit",1,"custom-control-label"],["formControlName","PaymentType","id","debit","name","PaymentType","type","radio","value","cash","required","",1,"custom-control-input",3,"change"],["for","debit",1,"custom-control-label"],["formControlName","PaymentType","id","paypal","name","PaymentType","type","radio","value","electronic","required","",1,"custom-control-input",3,"change"],["for","paypal",1,"custom-control-label"],["class","row",4,"ngIf"],[1,"form-group","row"],[1,"col","d-flex","justify-content-end"],["type","button",1,"btn","btn-primary",2,"margin-right","24px",3,"click"],[3,"showLoader"],["type","button",1,"btn","btn-danger","btn-sl-sm","mr-3",3,"click"],[1,"mr-2"],[1,"fa","fa-trash"],[1,"badge","badge-secondary","badge-pill"],[1,"list-group-item","d-flex","justify-content-between","lh-condensed"],[1,"my-0"],[3,"value"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"id","checked","change"],[1,"custom-control-label",3,"for"],[1,"col-md-12","mb-3"],["for","cc-name"],["type","text","id","cc-name","placeholder","","required","",1,"form-control"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),e._uU(4,"Pagos"),e.qZA(),e.TgZ(5,"p",3),e._uU(6,"nuevo registro"),e.qZA()()(),e.TgZ(7,"div",4),e.YNc(8,C,4,0,"button",5),e.TgZ(9,"button",6),e.NdJ("click",function(){return n.goBack()}),e._uU(10),e.qZA()()(),e.TgZ(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"h4",11),e._uU(16,"Informacion de pago"),e.qZA()(),e.TgZ(17,"div",12)(18,"div",13)(19,"h4",14)(20,"span",15),e._uU(21,"Detalle de pago"),e.qZA(),e.YNc(22,w,2,1,"span",16),e.qZA(),e.TgZ(23,"div",17)(24,"ul",18),e.YNc(25,A,8,3,"li",19),e.TgZ(26,"li",20)(27,"span"),e._uU(28,"Total (USD)"),e.qZA(),e.TgZ(29,"strong"),e._uU(30),e.qZA()()()()(),e.TgZ(31,"div",21)(32,"form",22)(33,"div",23)(34,"label",24),e._uU(35,"Estudiante"),e.qZA(),e.TgZ(36,"select",25)(37,"option",26),e._uU(38,"Elegir..."),e.qZA(),e.YNc(39,q,2,2,"option",27),e.qZA(),e.TgZ(40,"div",28),e._uU(41),e.qZA()(),e.TgZ(42,"div",23)(43,"label",24),e._uU(44,"Estatus"),e.qZA(),e.TgZ(45,"select",29)(46,"option",26),e._uU(47,"Elegir..."),e.qZA(),e.TgZ(48,"option",30),e._uU(49,"Pendiente"),e.qZA(),e.TgZ(50,"option",31),e._uU(51,"Completado"),e.qZA()(),e.TgZ(52,"div",28),e._uU(53),e.qZA()(),e.TgZ(54,"div",23)(55,"label",32),e._uU(56,"Fecha de Pago "),e.TgZ(57,"span",15),e._uU(58,"(Opcional)"),e.qZA()(),e._UZ(59,"input",33),e.qZA(),e._UZ(60,"hr",34),e.TgZ(61,"h4",23),e._uU(62,"Descripcion de pago"),e.qZA(),e.YNc(63,D,4,4,"div",35),e._UZ(64,"hr",34),e.TgZ(65,"h4",23),e._uU(66,"Tipo de pago"),e.qZA(),e.TgZ(67,"div",36)(68,"div",37)(69,"input",38),e.NdJ("change",function(i){return n.onRadioChange(i)}),e.qZA(),e.TgZ(70,"label",39),e._uU(71,"Punto de venta"),e.qZA()(),e.TgZ(72,"div",37)(73,"input",40),e.NdJ("change",function(i){return n.onRadioChange(i)}),e.qZA(),e.TgZ(74,"label",41),e._uU(75,"Efectivo"),e.qZA()(),e.TgZ(76,"div",37)(77,"input",42),e.NdJ("change",function(i){return n.onRadioChange(i)}),e.qZA(),e.TgZ(78,"label",43),e._uU(79,"Pago Movil / Transferencia"),e.qZA()(),e.TgZ(80,"div",28),e._uU(81),e.qZA()(),e.YNc(82,x,9,0,"div",44),e.qZA()()(),e._UZ(83,"hr",34),e.TgZ(84,"div",45)(85,"div",46)(86,"button",47),e.NdJ("click",function(){return n.sendForm()}),e._uU(87),e.qZA()()()()()(),e._UZ(88,"app-loader",48)),2&t&&(e.xp6(8),e.Q6J("ngIf","edit"==n.viewType),e.xp6(2),e.Oqu("salir"),e.xp6(12),e.Q6J("ngIf",n.paymentDetail.length>0),e.xp6(3),e.Q6J("ngForOf",n.paymentDetail),e.xp6(5),e.hij("$",n.totalUSD,""),e.xp6(2),e.Q6J("formGroup",n.formPayment),e.xp6(7),e.Q6J("ngForOf",n.studentsSelect),e.xp6(2),e.hij(" ",n.validatorOfInput("Student")," "),e.xp6(12),e.hij(" ",n.validatorOfInput("Status")," "),e.xp6(10),e.Q6J("ngForOf",n.products),e.xp6(18),e.hij(" ",n.validatorOfInput("PaymentType")," "),e.xp6(1),e.Q6J("ngIf","electronic"==n.paymenType),e.xp6(5),e.hij(" ",n.btnlabel,""),e.xp6(1),e.Q6J("showLoader",n.showLoader))},dependencies:[c.sg,c.O5,v.R,r._Y,r.YN,r.Kr,r.Fj,r.EJ,r._,r.JJ,r.JL,r.Q7,r.sg,r.u],styles:[".paymentDetailContainer[_ngcontent-%COMP%]{max-height:90vh;overflow:auto}"]}),a})();const N=[{path:"",component:P},{path:"new",component:Z},{path:"update/:uuid",component:Z}];let I=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[d.Bz.forChild(N),d.Bz]}),a})();var S=l(2795);let L=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[c.ez,S.m,I,r.UX]}),a})()}}]);