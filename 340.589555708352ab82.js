"use strict";(self.webpackChunkTerraForm=self.webpackChunkTerraForm||[]).push([[340],{9340:(H,g,l)=>{l.r(g),l.d(g,{PaymentsModule:()=>j});var m=l(817),c=l(6153),Z=l(7964),y=l.n(Z),e=l(3333),T=l(162),d=l(5556);let f=(()=>{class o extends T.U{getPayments(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/list",{headers:this.headers})}getPaymentsMonthlyPaymentOverview(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/MonthlyPaymentOverview",{headers:this.headers})}addPayment(t){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/new",t,{headers:this.headers})}getPaymentsByUuid(t){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/get/"+t,{headers:this.headers})}updPayment(t){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/upd",t,{headers:this.headers})}delPayment(t){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/delete",t,{headers:this.headers})}getAnalytics(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/analytics",{headers:this.headers})}getResources(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/resources",{headers:this.headers})}deleteDiscount(t){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/deleteDiscount",t,{headers:this.headers})}getLevelsbyStudents(t){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/registration/LvlByStudent/"+t,{headers:this.headers})}}return o.\u0275fac=function(){let i;return function(n){return(i||(i=e.n5z(o)))(n||o)}}(),o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var b=l(5391),v=l(2306);function P(o,i){if(1&o&&(e.TgZ(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14)(4,"div",15)(5,"div",16),e._uU(6,"Pagos completos"),e.qZA(),e.TgZ(7,"div",17),e._UZ(8,"i",18),e._uU(9),e.qZA()(),e.TgZ(10,"div",19),e._UZ(11,"div",20),e.qZA()()()(),e.TgZ(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16),e._uU(17,"Pagos Electronicos"),e.qZA(),e.TgZ(18,"div",17),e._UZ(19,"i",18),e._uU(20),e.qZA()(),e.TgZ(21,"div",19),e._UZ(22,"div",21),e.qZA()()()(),e.TgZ(23,"div",12)(24,"div",13)(25,"div",14)(26,"div",15)(27,"div",16),e._uU(28,"Pagos en Efectivo"),e.qZA(),e.TgZ(29,"div",17),e._UZ(30,"i",18),e._uU(31),e.qZA()(),e.TgZ(32,"div",19),e._UZ(33,"div",22),e.qZA()()()(),e.TgZ(34,"div",12)(35,"div",13)(36,"div",14)(37,"div",15)(38,"div",16),e._uU(39,"Pagos pendientes"),e.qZA(),e.TgZ(40,"div",17),e._UZ(41,"i",18),e._uU(42),e.qZA()(),e.TgZ(43,"div",19),e._UZ(44,"div",23),e.qZA()()()()()),2&o){const t=e.oxw();e.xp6(9),e.Oqu(t.metrics.completed),e.xp6(11),e.Oqu(t.metrics.electronic),e.xp6(11),e.hij(" ",t.metrics.cash,""),e.xp6(11),e.Oqu(t.metrics.pending)}}function C(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",11)(1,"div",24)(2,"div",13)(3,"div",25)(4,"div",26)(5,"app-table-terra",27),e.NdJ("deleteRow",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.deletePayment(a))}),e.qZA()()()()()()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("rowData",t.Payments)("idTable",2)}}function A(o,i){if(1&o&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Jzz("text-align: center; white-space: nowrap; ",3==t.Status?"background-color: #7ED321;":2==t.Status?"background-color: #d32121;":"background-color: #f2f2f2;",""),e.xp6(1),e.hij(" ",t.Amount," ")}}function U(o,i){if(1&o&&(e.TgZ(0,"tr")(1,"td",36),e._uU(2),e.qZA(),e.YNc(3,A,2,4,"td",37),e.qZA()),2&o){const t=i.$implicit;e.xp6(2),e.Oqu(t.Name),e.xp6(1),e.Q6J("ngForOf",t.payments)}}function w(o,i){if(1&o&&(e.TgZ(0,"div",11)(1,"div",24)(2,"div",13)(3,"div",28)(4,"h4",29),e._uU(5,"Relacion de Pagos Mensuales"),e.qZA()(),e.TgZ(6,"div",30)(7,"table",31)(8,"thead",32)(9,"tr")(10,"th",33),e._uU(11,"Nombre"),e.qZA(),e.TgZ(12,"th",34),e._uU(13,"Ene"),e.qZA(),e.TgZ(14,"th",34),e._uU(15,"Feb"),e.qZA(),e.TgZ(16,"th",34),e._uU(17,"Mar"),e.qZA(),e.TgZ(18,"th",34),e._uU(19,"Abr"),e.qZA(),e.TgZ(20,"th",34),e._uU(21,"May"),e.qZA(),e.TgZ(22,"th",34),e._uU(23,"Jun"),e.qZA(),e.TgZ(24,"th",34),e._uU(25,"Jul"),e.qZA(),e.TgZ(26,"th",34),e._uU(27,"Ago"),e.qZA(),e.TgZ(28,"th",34),e._uU(29,"Sep"),e.qZA(),e.TgZ(30,"th",34),e._uU(31,"Oct"),e.qZA(),e.TgZ(32,"th",34),e._uU(33,"Nov"),e.qZA(),e.TgZ(34,"th",34),e._uU(35,"Dic"),e.qZA()()(),e.TgZ(36,"tbody"),e.YNc(37,U,4,2,"tr",35),e.qZA()()()()()()),2&o){const t=e.oxw();e.xp6(37),e.Q6J("ngForOf",t.StudentsMonths)}}let q=(()=>{class o{constructor(t,n,a){this._service=t,this.router=n,this.route=a,this.Payments=[],this.showLoader=!0,this.metrics={completed:0,electronic:0,cash:0,pending:0},this.StudentsMonths=[],this.showMonthlyPaymentOverview=!1}ngOnInit(){this.getList()}getList(){this.showLoader=!0,this._service.getPayments().subscribe(t=>{this.Payments=t,this.showLoader=!1}),this.loadAnalytics()}getListMonthlyPaymentOverview(){this.showLoader=!0,this._service.getPaymentsMonthlyPaymentOverview().subscribe(t=>{t.forEach(a=>{let s=[{IdMonth:1,Amount:"",Status:1},{IdMonth:2,Amount:"",Status:1},{IdMonth:3,Amount:"",Status:1},{IdMonth:4,Amount:"",Status:1},{IdMonth:5,Amount:"",Status:1},{IdMonth:6,Amount:"",Status:1},{IdMonth:7,Amount:"",Status:1},{IdMonth:8,Amount:"",Status:1},{IdMonth:9,Amount:"",Status:1},{IdMonth:10,Amount:"",Status:1},{IdMonth:11,Amount:"",Status:1},{IdMonth:12,Amount:"",Status:1}];a.payments.forEach(u=>{s[u.IdMonth-1]=u}),this.StudentsMonths.push({Name:a.Name,payments:s})}),this.showLoader=!1})}loadAnalytics(){this.showLoader=!0,this._service.getAnalytics().subscribe(t=>{this.metrics=t,this.showLoader=!1})}deletePayment(t){y().fire({title:"Cuidado",text:"\xbfDesea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar!",cancelButtonText:"Cancelar"}).then(n=>{console.log(n),this.showLoader=!0,n.isConfirmed?this._service.delPayment({uuid:t.uuid}).subscribe(a=>{this.showLoader=!1,this.getList()}):this.showLoader=!1})}goToAdd(){this.router.navigate(["admin/payments/new"])}toggleTable(){this.showMonthlyPaymentOverview=!this.showMonthlyPaymentOverview,this.showMonthlyPaymentOverview&&this.getListMonthlyPaymentOverview()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f),e.Y36(c.F0),e.Y36(c.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-payments-list"]],decls:20,vars:4,consts:[[1,"row","page-titles","mx-0"],[1,"col-sm-6","p-md-0"],[1,"welcome-text"],[1,"mb-1"],[1,"col-sm-6","p-md-0","justify-content-sm-end","mt-2","mt-sm-0","d-flex"],["type","button",1,"btn","btn-success","btn-sl-sm","mr-3",3,"click"],[1,"mr-2"],[1,"fa","fa-plus"],["type","button",1,"btn","btn-primary","btn-sl-sm","mr-3",3,"click"],["class","row",4,"ngIf"],[3,"showLoader"],[1,"row"],[1,"col-lg-3","col-sm-6"],[1,"card"],[1,"stat-widget-two","card-body"],[1,"stat-content"],[1,"stat-text"],[1,"stat-digit"],[1,"fa","fa-money"],[1,"progress"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-success","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-primary","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-warning","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-danger","w-100"],[1,"col-12"],[1,"card-body"],[2,"width","100%","height","100%"],[3,"rowData","idTable","deleteRow"],[1,"card-header"],[1,"card-title"],[1,"card-body",2,"overflow","scroll"],[1,"table","table-striped","table-hover"],[1,"thead-dark"],[2,"text-align","center","white-space","nowrap"],[2,"text-align","center"],[4,"ngFor","ngForOf"],[2,"white-space","nowrap"],[3,"style",4,"ngFor","ngForOf"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),e._uU(4,"Pagos"),e.qZA(),e.TgZ(5,"p",3),e._uU(6,"Pagos Registrados"),e.qZA()()(),e.TgZ(7,"div",4)(8,"button",5),e.NdJ("click",function(){return n.toggleTable()}),e.TgZ(9,"span",6),e._UZ(10,"i",7),e.qZA(),e._uU(11," pagos mensuales"),e.qZA(),e.TgZ(12,"button",8),e.NdJ("click",function(){return n.goToAdd()}),e.TgZ(13,"span",6),e._UZ(14,"i",7),e.qZA(),e._uU(15," Nuevo registro"),e.qZA()()(),e.YNc(16,P,45,4,"div",9),e.YNc(17,C,6,2,"div",9),e.YNc(18,w,38,1,"div",9),e._UZ(19,"app-loader",10)),2&t&&(e.xp6(16),e.Q6J("ngIf",!n.showMonthlyPaymentOverview),e.xp6(1),e.Q6J("ngIf",!n.showMonthlyPaymentOverview),e.xp6(1),e.Q6J("ngIf",n.showMonthlyPaymentOverview),e.xp6(1),e.Q6J("showLoader",n.showLoader))},dependencies:[m.sg,m.O5,b.x,v.R]}),o})();var p=l(7036),r=l(8765),I=l(8617);const x=["discountInput"];function D(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.deletePayment())}),e.TgZ(1,"span",64),e._UZ(2,"i",65),e.qZA(),e._uU(3," Eliminar"),e.qZA()}}function S(o,i){if(1&o&&(e.TgZ(0,"option",66),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.UUID),e.xp6(1),e.Oqu(t.Name)}}function N(o,i){if(1&o&&(e.TgZ(0,"option",66),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.IdMonth),e.xp6(1),e.Oqu(t.Name)}}function M(o,i){if(1&o&&(e.TgZ(0,"div",15)(1,"label",67),e._uU(2,"Mes a pagar"),e.qZA(),e.TgZ(3,"select",68)(4,"option",69),e._uU(5,"Elegir..."),e.qZA(),e.YNc(6,N,2,2,"option",19),e.qZA(),e.TgZ(7,"div",20),e._uU(8),e.qZA()()),2&o){const t=e.oxw();e.xp6(6),e.Q6J("ngForOf",t.months),e.xp6(2),e.hij(" ",t.validatorOfInput("IdMonth")," ")}}function k(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",71)(1,"input",72),e.NdJ("change",function(a){const u=e.CHM(t).$implicit,h=e.oxw(2);return e.KtG(h.onCheckChange(a,u))}),e.qZA(),e.TgZ(2,"label",73),e._uU(3),e.qZA()()}if(2&o){const t=i.$implicit,n=e.oxw(2);e.xp6(1),e.s9C("id",t.UUID),e.Q6J("checked",n.validateCheck(t)),e.xp6(1),e.s9C("for",t.UUID),e.xp6(1),e.Oqu(t.Name)}}function O(o,i){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,k,4,4,"div",70),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.products)}}function L(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",71)(1,"input",72),e.NdJ("change",function(a){const u=e.CHM(t).$implicit,h=e.oxw(2);return e.KtG(h.onCheckChangeLevels(a,u))}),e.qZA(),e.TgZ(2,"label",73),e._uU(3),e.qZA()()}if(2&o){const t=i.$implicit,n=e.oxw(2);e.xp6(1),e.s9C("id",t.UUID),e.Q6J("checked",n.validateCheck(t)),e.xp6(1),e.s9C("for",t.UUID),e.xp6(1),e.Oqu(t.Name)}}function J(o,i){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,L,4,4,"div",70),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.levels)}}function F(o,i){if(1&o&&(e.TgZ(0,"div",8)(1,"div",74)(2,"label",75),e._uU(3,"Referencia"),e.qZA(),e._UZ(4,"input",76),e.TgZ(5,"small",33),e._uU(6,"Agregar referencia"),e.qZA(),e.TgZ(7,"div",20),e._uU(8),e.qZA()()()),2&o){const t=e.oxw();e.xp6(8),e.hij(" ",t.validatorOfInput("Reference")," ")}}function B(o,i){if(1&o&&(e.TgZ(0,"li",77)(1,"div")(2,"h6",78),e._uU(3),e.qZA(),e.TgZ(4,"small",33),e._uU(5),e.qZA()(),e.TgZ(6,"span",33),e._uU(7),e.qZA()()),2&o){const t=i.$implicit;e.xp6(3),e.Oqu(t.Name),e.xp6(2),e.Oqu(t.Description),e.xp6(2),e.Oqu(t.AmountString)}}function R(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"li",50)(1,"span")(2,"button",79),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.deleteDiscount())}),e._UZ(3,"i",80),e.qZA(),e._uU(4," Descuento (USD) "),e.qZA(),e.TgZ(5,"strong"),e._uU(6),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(6),e.hij("$",t.discount,"")}}function E(o,i){if(1&o&&(e.TgZ(0,"li",50)(1,"span"),e._uU(2,"Resta pagar (USD)"),e.qZA(),e.TgZ(3,"strong"),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.hij("-$",t.pendingAmount,"")}}let _=(()=>{class o{constructor(t,n,a,s){this._service=t,this.router=n,this.route=a,this.alert=s,this.formHasBeenSave=!1,this.showLoader=!0,this.disableForm=!1,this.uuid=null,this.viewType="add",this.btnlabel="Agregar",this.studentsSelect=[],this.paymentDetail=[],this.products=[],this.levels=[],this.months=[],this.discount=0,this.totalUSD=0,this.PaymentDescription="",this.productsOnPayments=[],this.paymentMethod="",this.paymentType=null,this.LevelsOnPayments=[],this.pagoIncompleto=!1,this.pendingAmount=0,this.createForm(),this.subscribeChangeForm(),this.loadSelects()}ngOnInit(){this.showLoader=!0,this.route.params.subscribe(t=>{this.uuid=t.uuid,void 0!==this.uuid?(this.showLoader=!1,this.viewType="edit",this.loadPayment(),this.btnlabel="Guardar"):this.showLoader=!1})}loadSelects(){this.showLoader=!0,this._service.getResources().subscribe(t=>{let n=t;this.studentsSelect=n.students,this.products=n.products,this.levels=n.levels,this.months=n.months,this.showLoader=!1})}subscribeChangeForm(){this.formPayment.valueChanges.subscribe(t=>{this.formPayment.pristine||(this.formHasBeenSave=!1)})}loadPayment(){this.showLoader=!0,this._service.getPaymentsByUuid(this.uuid).subscribe(t=>{console.log(t),this.setFormPayment(t),this.showLoader=!1})}setFormPayment(t){this.formPayment.get("Amount").patchValue(t.Amount),this.formPayment.get("Currency").patchValue(t.Currency),this.formPayment.get("Student").patchValue(t.Student.UUID),this.formPayment.get("PaymentDate").patchValue(t.PaymentDate),this.formPayment.get("Observation").patchValue(t.Observation),this.formPayment.get("UUID").patchValue(t.UUID),this.formPayment.get("PaymentMethod").patchValue(t.PaymentMethod),this.formPayment.get("PaymentType").patchValue(t.PaymentType.toString()),this.formPayment.get("Reference").patchValue(t.Reference),this.formPayment.get("Create_at").patchValue(t.Create_at),this.formPayment.get("Description").patchValue(t.Description),this.formPayment.get("Status").patchValue(t.Status),t.Discount&&t.Discount.Amount&&(this.formPayment.get("Discount").patchValue(t.Discount.Amount),this.discount=t.Discount.Amount),this.paymentMethodEvaluate(t.PaymentMethod),this.paymentType=t.PaymentType.toString(),2==t.PaymentType?(this.formPayment.get("IdMonth").disable(),this.paymentDetail=t.products):(this.formPayment.get("IdMonth").patchValue(t.MonthlyPayment.IdMonth),this.formPayment.get("IdMonth").enable(),this.paymentDetail=t.levels),this.calculateTotals(),this.pendingAmountCheck(t.Amount)}createForm(){this.formPayment=new r.cw({Amount:new r.NI(0,[r.kI.required]),Currency:new r.NI(2),Student:new r.NI("",[r.kI.required]),PaymentDate:new r.NI(""),Observation:new r.NI(""),UUID:new r.NI(""),PaymentMethod:new r.NI("",[r.kI.required]),PaymentType:new r.NI(1,[r.kI.required]),Reference:new r.NI(""),Create_at:new r.NI(""),Description:new r.NI("",[r.kI.required]),Status:new r.NI(3,[r.kI.required]),IdMonth:new r.NI(null,[r.kI.required]),Discount:new r.NI(null)}),this.formPayment.controls.PaymentType.setValue("1"),this.paymentType=1}sendForm(){var t=this;return(0,p.Z)(function*(){if(t.formHasBeenSave=!0,t.disableForm=!0,t.formPayment.valid){t.showLoader=!0,t.formPayment.get("Status").enable();let n=t.formPayment.value,a={};a.payment=n,t.discount&&(a.discount=n.Discount),1==n.PaymentType?a.levels=t.paymentDetail:2==n.PaymentType&&(a.products=t.paymentDetail),"add"==t.viewType?t._service.addPayment(a).subscribe(function(){var s=(0,p.Z)(function*(u){t.alert.success("Registro Creado","Se ha creado el registro"),t.goBack()});return function(u){return s.apply(this,arguments)}}(),s=>{console.log(s),t.disableForm=!1,t.showLoader=!1}):(t.alert.success("Registro Actualizado","Se ha actualizado el registro"),t._service.updPayment(a).subscribe(function(){var s=(0,p.Z)(function*(u){t.formPayment.get("Status").disable(),t.showLoader=!1});return function(u){return s.apply(this,arguments)}}(),s=>{console.log(s),t.disableForm=!1,t.showLoader=!1}))}else t.alert.warning("Campos invalidos","Verifique los campos marcados")})()}deletePayment(){y().fire({title:"Cuidado",text:"\xbfDesea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar!",cancelButtonText:"Cancelar"}).then(t=>{console.log(t),t.isConfirmed&&this._service.delPayment({uuid:this.uuid}).subscribe(n=>{this.goBack()})})}goBack(){this.router.navigate(["admin/payments"])}validateCheck(t){let n=null;return n=this.paymentDetail.find(a=>a.UUID==t.UUID),!!n}onChangeStudent(){this.showLoader=!0,this._service.getLevelsbyStudents(this.formPayment.get("Student").value).subscribe(t=>{let n=t;this.paymentDetail=[],n.forEach(a=>{let s=this.levels.find(u=>u.UUID==a.UUID);this.paymentDetail.push(s),this.calculateTotals()}),this.showLoader=!1})}onCheckChange(t,n){console.log(n),t.target.checked?this.paymentDetail.push(n):this.paymentDetail=this.paymentDetail.filter(a=>a.UUID!=n.UUID),this.calculateTotals()}onRadioChange(t){this.paymentMethodEvaluate(t.target.value)}paymentMethodEvaluate(t){this.paymentMethod=t,"electronic"==this.paymentMethod?this.formPayment.get("Reference").enable():this.formPayment.get("Reference").disable()}onRadioChangeLevels(t){this.paymentType=t.target.value,this.paymentDetail=[],2==this.paymentType?this.formPayment.get("IdMonth").disable():this.formPayment.get("IdMonth").enable()}onCheckChangeLevels(t,n){t.target.checked?this.paymentDetail.push(n):this.paymentDetail=this.paymentDetail.filter(a=>a.UUID!=n.UUID),this.calculateTotals(),this.pendingAmountCheck()}calculateTotals(){this.discount>this.totalUSD&&this.deleteDiscount(),this.totalUSD=this.paymentDetail.reduce((t,n)=>t+n.Amount,0)-this.discount,this.PaymentDescription=this.paymentDetail.reduce((t,n)=>t+" | "+n.Description,""),this.PaymentDescription=this.PaymentDescription.slice(0,99),this.formPayment.get("Description").patchValue(this.PaymentDescription)}validatorOfInput(t){let s,n=this.formPayment.get(t);if(!(n.touched&&n.invalid||this.formHasBeenSave&&n.invalid))return"";if(n.errors.required)return s="Campo Requerido.",s;if(n.errors.pattern)return s="El formato no es valido",s;if(n.errors.minlength)return s=`Debe contener al menos ${n.errors.minlength.requiredLength} caracteres`,s;if(n.errors.maxlength){let h=n.value.substring(0,n.value.length-1);n.patchValue(h)}}checkTotalStatus(t){console.log(t.target.value),this.formPayment.get("Status").disable(),this.totalUSD>t.target.value?(this.pendingAmount=this.totalUSD-parseFloat(t.target.value),this.pagoIncompleto=!0,this.formPayment.get("Status").patchValue(2)):this.totalUSD==t.target.value&&(this.formPayment.get("Status").patchValue(3),this.pagoIncompleto=!1)}pendingAmountCheck(t=null){null==t&&(t=this.formPayment.get("Amount").value),this.totalUSD>t?(this.pendingAmount=this.totalUSD-t,this.pagoIncompleto=!0,this.formPayment.get("Status").patchValue(2),this.formPayment.get("Status").disable()):(this.pagoIncompleto=!1,this.formPayment.get("Status").patchValue(3),this.formPayment.get("Status").enable())}addDiscount(){let t=parseFloat(this.discountInput.nativeElement.value);if(t<=this.totalUSD){this.discount=t,this.formPayment.get("Discount").patchValue(t),this.calculateTotals();let n=this.formPayment.get("Amount").value;this.pendingAmountCheck(n),this.alert.success("Exito","Descuento agregado")}else this.alert.error("Error","El monto del descuento no puede ser mayor al total")}deleteDiscount(){this._service.deleteDiscount({uuid:this.uuid}).subscribe(t=>{this.discount=0,this.calculateTotals();let n=this.formPayment.get("Amount").value;this.pendingAmountCheck(n),this.alert.warning("Alerta","Descuento Eliminado")})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f),e.Y36(c.F0),e.Y36(c.gz),e.Y36(I.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-payment-crud"]],viewQuery:function(t,n){if(1&t&&e.Gf(x,7),2&t){let a;e.iGM(a=e.CRH())&&(n.discountInput=a.first)}},decls:128,vars:20,consts:[[1,"row","page-titles","mx-0"],[1,"col-sm-6","p-md-0"],[1,"welcome-text"],[1,"mb-1"],[1,"col-sm-6","p-md-0","justify-content-sm-end","mt-2","mt-sm-0","d-flex"],["class","btn btn-danger btn-sl-sm mr-3","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-warning",3,"click"],["novalidate","",1,"needs-validation",3,"formGroup"],[1,"row"],[1,"col-lg-8"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"col-md-12","order-md-1"],[1,"mb-3"],["for","Student"],["id","Student","required","","formControlName","Student",1,"custom-select","d-block","w-100",3,"change"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"invalid-feedback"],[1,"mb-4"],[1,"d-block","my-3"],[1,"custom-control","custom-radio"],["formControlName","PaymentType","id","levels","name","PaymentType","type","radio","value","1","required","",1,"custom-control-input",3,"change"],["for","levels",1,"custom-control-label"],["formControlName","PaymentType","id","products","name","PaymentType","type","radio","value","2","required","",1,"custom-control-input",3,"change"],["for","products",1,"custom-control-label"],["id","Student","required","","formControlName","Status",1,"custom-select","d-block","w-100","disabled"],["value","1"],["value","2"],["value","3"],["for","PaymentDate"],[1,"text-muted"],["type","date","id","PaymentDate","formControlName","PaymentDate","placeholder","dd/mm/yyyy",1,"form-control"],["class","mb-3",4,"ngIf"],[1,"row","ml-2"],[4,"ngIf"],["formControlName","PaymentMethod","id","credit","name","PaymentMethod","type","radio","checked","","value","POS","required","",1,"custom-control-input",3,"change"],["for","credit",1,"custom-control-label"],["formControlName","PaymentMethod","id","debit","name","PaymentMethod","type","radio","value","cash","required","",1,"custom-control-input",3,"change"],["for","debit",1,"custom-control-label"],["formControlName","PaymentMethod","id","movil","name","PaymentMethod","type","radio","value","electronic","required","",1,"custom-control-input",3,"change"],["for","movil",1,"custom-control-label"],["class","row",4,"ngIf"],[1,"col-md-4","col-lg-4","order-md-2","mb-4"],[1,"paymentDetailContainer"],[1,"list-group","mb-3"],["class","list-group-item d-flex justify-content-between lh-condensed",4,"ngFor","ngForOf"],["class","list-group-item d-flex justify-content-between",4,"ngIf"],[1,"list-group-item","d-flex","justify-content-between"],[1,"input-group"],["type","number","min","0","formControlName","Amount","placeholder","$0",1,"form-control",3,"keyup"],["type","number","min","0","placeholder","Descuento en USD",1,"form-control",3,"max"],["discountInput",""],[1,"input-group-append"],["type","submit",1,"btn","btn-secondary",3,"click"],[1,"col-lg-12"],[1,"card","mb-4"],[1,""],[1,"col","d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"showLoader"],["type","button",1,"btn","btn-danger","btn-sl-sm","mr-3",3,"click"],[1,"mr-2"],[1,"fa","fa-trash"],[3,"value"],["for","IdMonth"],["id","IdMonth","required","","formControlName","IdMonth",1,"custom-select","d-block","w-100"],["value","0","selected",""],["class","custom-control custom-checkbox col-md-6 col-md-lg col-sm-12",4,"ngFor","ngForOf"],[1,"custom-control","custom-checkbox","col-md-6","col-md-lg","col-sm-12"],["type","checkbox",1,"custom-control-input",3,"id","checked","change"],[1,"custom-control-label",3,"for"],[1,"col-md-12","mb-3"],["for","cc-name"],["type","text","id","cc-name","formControlName","Reference","placeholder","","required","",1,"form-control"],[1,"list-group-item","d-flex","justify-content-between","lh-condensed"],[1,"my-0"],["type","button",1,"btn",3,"click"],[1,"fa","fa-trash",2,"color","red"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),e._uU(4,"Pagos"),e.qZA(),e.TgZ(5,"p",3),e._uU(6,"nuevo registro"),e.qZA()()(),e.TgZ(7,"div",4),e.YNc(8,D,4,0,"button",5),e.TgZ(9,"button",6),e.NdJ("click",function(){return n.goBack()}),e._uU(10),e.qZA()()(),e.TgZ(11,"form",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"h4",12),e._uU(17,"Informacion de pago"),e.qZA()(),e.TgZ(18,"div",13)(19,"div",14)(20,"div",15)(21,"label",16),e._uU(22,"Estudiante"),e.qZA(),e.TgZ(23,"select",17),e.NdJ("change",function(){return n.onChangeStudent()}),e.TgZ(24,"option",18),e._uU(25,"Elegir..."),e.qZA(),e.YNc(26,S,2,2,"option",19),e.qZA(),e.TgZ(27,"div",20),e._uU(28),e.qZA()(),e._UZ(29,"hr",21),e.TgZ(30,"h4",15),e._uU(31,"Tipo de pago"),e.qZA(),e.TgZ(32,"div",22)(33,"div",23)(34,"input",24),e.NdJ("change",function(s){return n.onRadioChangeLevels(s)}),e.qZA(),e.TgZ(35,"label",25),e._uU(36,"Pago por niveles"),e.qZA()(),e.TgZ(37,"div",23)(38,"input",26),e.NdJ("change",function(s){return n.onRadioChangeLevels(s)}),e.qZA(),e.TgZ(39,"label",27),e._uU(40,"Otros"),e.qZA()(),e.TgZ(41,"div",20),e._uU(42),e.qZA()(),e.TgZ(43,"div",15)(44,"label",16),e._uU(45,"Estatus"),e.qZA(),e.TgZ(46,"select",28)(47,"option",18),e._uU(48,"Elegir..."),e.qZA(),e.TgZ(49,"option",29),e._uU(50,"Pendiente"),e.qZA(),e.TgZ(51,"option",30),e._uU(52,"Abonado"),e.qZA(),e.TgZ(53,"option",31),e._uU(54,"Completado"),e.qZA()(),e.TgZ(55,"div",20),e._uU(56),e.qZA()(),e.TgZ(57,"div",15)(58,"label",32),e._uU(59,"Fecha de Pago "),e.TgZ(60,"span",33),e._uU(61,"(Opcional)"),e.qZA()(),e._UZ(62,"input",34),e.qZA(),e.YNc(63,M,9,2,"div",35),e._UZ(64,"hr",21),e.TgZ(65,"h4",15),e._uU(66,"Descripcion de pago"),e.qZA(),e.TgZ(67,"div",36),e.YNc(68,O,2,1,"div",37),e.YNc(69,J,2,1,"div",37),e.TgZ(70,"div",20),e._uU(71),e.qZA()(),e._UZ(72,"hr",21),e.TgZ(73,"h4",15),e._uU(74,"Metodo de pago"),e.qZA(),e.TgZ(75,"div",22)(76,"div",23)(77,"input",38),e.NdJ("change",function(s){return n.onRadioChange(s)}),e.qZA(),e.TgZ(78,"label",39),e._uU(79,"Punto de venta"),e.qZA()(),e.TgZ(80,"div",23)(81,"input",40),e.NdJ("change",function(s){return n.onRadioChange(s)}),e.qZA(),e.TgZ(82,"label",41),e._uU(83,"Efectivo"),e.qZA()(),e.TgZ(84,"div",23)(85,"input",42),e.NdJ("change",function(s){return n.onRadioChange(s)}),e.qZA(),e.TgZ(86,"label",43),e._uU(87,"Trasferencia / Pago movil"),e.qZA()(),e.TgZ(88,"div",20),e._uU(89),e.qZA()(),e.YNc(90,F,9,1,"div",44),e.qZA()(),e._UZ(91,"hr",21),e.qZA()(),e.TgZ(92,"div",45)(93,"div",10)(94,"div",11)(95,"h4",12),e._uU(96,"Detalle de pago"),e.qZA()(),e.TgZ(97,"div",13)(98,"div",46)(99,"ul",47),e.YNc(100,B,8,3,"li",48),e.YNc(101,R,7,1,"li",49),e.TgZ(102,"li",50)(103,"span"),e._uU(104,"Total a pagar (USD)"),e.qZA(),e.TgZ(105,"strong"),e._uU(106),e.qZA()(),e.YNc(107,E,5,1,"li",49),e.TgZ(108,"li",50)(109,"span"),e._uU(110,"Total (USD)"),e.qZA(),e.TgZ(111,"div",51)(112,"input",52),e.NdJ("keyup",function(s){return n.checkTotalStatus(s)}),e.qZA()()()()(),e.TgZ(113,"div",51),e._UZ(114,"input",53,54),e.TgZ(116,"div",55)(117,"button",56),e.NdJ("click",function(){return n.addDiscount()}),e._uU(118,"Agregar"),e.qZA()()()()()()(),e.TgZ(119,"div",8)(120,"div",57)(121,"div",58)(122,"div",13)(123,"div",59)(124,"div",60)(125,"button",61),e.NdJ("click",function(){return n.sendForm()}),e._uU(126),e.qZA()()()()()()()(),e._UZ(127,"app-loader",62)),2&t&&(e.xp6(8),e.Q6J("ngIf","edit"==n.viewType),e.xp6(2),e.Oqu("salir"),e.xp6(1),e.Q6J("formGroup",n.formPayment),e.xp6(15),e.Q6J("ngForOf",n.studentsSelect),e.xp6(2),e.hij(" ",n.validatorOfInput("Student")," "),e.xp6(14),e.hij(" ",n.validatorOfInput("PaymentType")," "),e.xp6(14),e.hij(" ",n.validatorOfInput("Status")," "),e.xp6(7),e.Q6J("ngIf",1==n.paymentType),e.xp6(5),e.Q6J("ngIf",2==n.paymentType),e.xp6(1),e.Q6J("ngIf",1==n.paymentType),e.xp6(2),e.hij(" ",n.validatorOfInput("Description")," "),e.xp6(18),e.hij(" ",n.validatorOfInput("PaymentMethod")," "),e.xp6(1),e.Q6J("ngIf","electronic"==n.paymentMethod),e.xp6(10),e.Q6J("ngForOf",n.paymentDetail),e.xp6(1),e.Q6J("ngIf",n.discount),e.xp6(5),e.hij("$",n.totalUSD,""),e.xp6(1),e.Q6J("ngIf",n.pagoIncompleto&&n.pendingAmount>0),e.xp6(7),e.s9C("max",n.totalUSD),e.xp6(12),e.Oqu(n.btnlabel),e.xp6(1),e.Q6J("showLoader",n.showLoader))},dependencies:[m.sg,m.O5,v.R,r._Y,r.YN,r.Kr,r.Fj,r.wV,r.EJ,r._,r.JJ,r.JL,r.Q7,r.qQ,r.sg,r.u],styles:[".paymentDetailContainer[_ngcontent-%COMP%]{max-height:90vh;overflow:auto}"]}),o})();const Q=[{path:"",component:q},{path:"new",component:_},{path:"update/:uuid",component:_}];let Y=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[c.Bz.forChild(Q),c.Bz]}),o})();var V=l(2795);let j=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.ez,V.m,Y,r.UX]}),o})()}}]);