"use strict";(self.webpackChunkTerraForm=self.webpackChunkTerraForm||[]).push([[340],{9340:(H,g,l)=>{l.r(g),l.d(g,{PaymentsModule:()=>j});var c=l(817),m=l(6153),Z=l(7964),y=l.n(Z),t=l(3333),T=l(162),d=l(5556);let f=(()=>{class o extends T.U{getPayments(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/list",{headers:this.headers})}getPaymentsMonthlyPaymentOverview(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/MonthlyPaymentOverview",{headers:this.headers})}addPayment(e){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/new",e,{headers:this.headers})}getPaymentsByUuid(e){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/get/"+e,{headers:this.headers})}updPayment(e){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/upd",e,{headers:this.headers})}delPayment(e){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/delete",e,{headers:this.headers})}getAnalytics(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/analytics",{headers:this.headers})}getResources(){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/payments/resources",{headers:this.headers})}deleteDiscount(e){return this.prepareTokenHeader(),this.http.post(d.N.routerBase+"/payments/deleteDiscount",e,{headers:this.headers})}getLevelsbyStudents(e){return this.prepareTokenHeader(),this.http.get(d.N.routerBase+"/registration/LvlByStudent/"+e,{headers:this.headers})}}return o.\u0275fac=function(){let i;return function(n){return(i||(i=t.n5z(o)))(n||o)}}(),o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var b=l(5391),v=l(2306);function P(o,i){if(1&o&&(t.TgZ(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14)(4,"div",15)(5,"div",16),t._uU(6,"Pagos completos"),t.qZA(),t.TgZ(7,"div",17),t._UZ(8,"i",18),t._uU(9),t.qZA()(),t.TgZ(10,"div",19),t._UZ(11,"div",20),t.qZA()()()(),t.TgZ(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16),t._uU(17,"Pagos Electronicos"),t.qZA(),t.TgZ(18,"div",17),t._UZ(19,"i",18),t._uU(20),t.qZA()(),t.TgZ(21,"div",19),t._UZ(22,"div",21),t.qZA()()()(),t.TgZ(23,"div",12)(24,"div",13)(25,"div",14)(26,"div",15)(27,"div",16),t._uU(28,"Pagos en Efectivo"),t.qZA(),t.TgZ(29,"div",17),t._UZ(30,"i",18),t._uU(31),t.qZA()(),t.TgZ(32,"div",19),t._UZ(33,"div",22),t.qZA()()()(),t.TgZ(34,"div",12)(35,"div",13)(36,"div",14)(37,"div",15)(38,"div",16),t._uU(39,"Pagos pendientes"),t.qZA(),t.TgZ(40,"div",17),t._UZ(41,"i",18),t._uU(42),t.qZA()(),t.TgZ(43,"div",19),t._UZ(44,"div",23),t.qZA()()()()()),2&o){const e=t.oxw();t.xp6(9),t.Oqu(e.metrics.completed),t.xp6(11),t.Oqu(e.metrics.electronic),t.xp6(11),t.hij(" ",e.metrics.cash,""),t.xp6(11),t.Oqu(e.metrics.pending)}}function C(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"div",11)(1,"div",24)(2,"div",13)(3,"div",25)(4,"div",26)(5,"app-table-terra",27),t.NdJ("deleteRow",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.deletePayment(a))}),t.qZA()()()()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("rowData",e.Payments)("idTable",2)}}function A(o,i){if(1&o&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Jzz("text-align: center; ",3==e.Status?"background-color: #7ED321;":2==e.Status?"background-color: #d32121;":"background-color: #f2f2f2;",""),t.xp6(1),t.hij(" ",e.Amount," ")}}function U(o,i){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.YNc(3,A,2,4,"td",35),t.qZA()),2&o){const e=i.$implicit;t.xp6(2),t.Oqu(e.Name),t.xp6(1),t.Q6J("ngForOf",e.payments)}}function w(o,i){if(1&o&&(t.TgZ(0,"div",11)(1,"div",24)(2,"div",13)(3,"div",28)(4,"h4",29),t._uU(5,"Relacion de Pagos Mensuales"),t.qZA()(),t.TgZ(6,"div",30)(7,"table",31)(8,"thead",32)(9,"tr")(10,"th",33),t._uU(11,"Nombre"),t.qZA(),t.TgZ(12,"th",33),t._uU(13,"Ene"),t.qZA(),t.TgZ(14,"th",33),t._uU(15,"Feb"),t.qZA(),t.TgZ(16,"th",33),t._uU(17,"Mar"),t.qZA(),t.TgZ(18,"th",33),t._uU(19,"Abr"),t.qZA(),t.TgZ(20,"th",33),t._uU(21,"May"),t.qZA(),t.TgZ(22,"th",33),t._uU(23,"Jun"),t.qZA(),t.TgZ(24,"th",33),t._uU(25,"Jul"),t.qZA(),t.TgZ(26,"th",33),t._uU(27,"Ago"),t.qZA(),t.TgZ(28,"th",33),t._uU(29,"Sep"),t.qZA(),t.TgZ(30,"th",33),t._uU(31,"Oct"),t.qZA(),t.TgZ(32,"th",33),t._uU(33,"Nov"),t.qZA(),t.TgZ(34,"th",33),t._uU(35,"Dic"),t.qZA()()(),t.TgZ(36,"tbody"),t.YNc(37,U,4,2,"tr",34),t.qZA()()()()()()),2&o){const e=t.oxw();t.xp6(37),t.Q6J("ngForOf",e.StudentsMonths)}}let q=(()=>{class o{constructor(e,n,a){this._service=e,this.router=n,this.route=a,this.Payments=[],this.showLoader=!0,this.metrics={completed:0,electronic:0,cash:0,pending:0},this.StudentsMonths=[],this.showMonthlyPaymentOverview=!1}ngOnInit(){this.getList()}getList(){this.showLoader=!0,this._service.getPayments().subscribe(e=>{this.Payments=e,this.showLoader=!1}),this.loadAnalytics()}getListMonthlyPaymentOverview(){this.showLoader=!0,this._service.getPaymentsMonthlyPaymentOverview().subscribe(e=>{e.forEach(a=>{let s=[{IdMonth:1,Amount:"",Status:1},{IdMonth:2,Amount:"",Status:1},{IdMonth:3,Amount:"",Status:1},{IdMonth:4,Amount:"",Status:1},{IdMonth:5,Amount:"",Status:1},{IdMonth:6,Amount:"",Status:1},{IdMonth:7,Amount:"",Status:1},{IdMonth:8,Amount:"",Status:1},{IdMonth:9,Amount:"",Status:1},{IdMonth:10,Amount:"",Status:1},{IdMonth:11,Amount:"",Status:1},{IdMonth:12,Amount:"",Status:1}];a.payments.forEach(u=>{s[u.IdMonth-1]=u}),this.StudentsMonths.push({Name:a.Name,payments:s})}),this.showLoader=!1})}loadAnalytics(){this.showLoader=!0,this._service.getAnalytics().subscribe(e=>{this.metrics=e,this.showLoader=!1})}deletePayment(e){y().fire({title:"Cuidado",text:"\xbfDesea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar!",cancelButtonText:"Cancelar"}).then(n=>{console.log(n),this.showLoader=!0,n.isConfirmed?this._service.delPayment({uuid:e.uuid}).subscribe(a=>{this.showLoader=!1,this.getList()}):this.showLoader=!1})}goToAdd(){this.router.navigate(["admin/payments/new"])}toggleTable(){this.showMonthlyPaymentOverview=!this.showMonthlyPaymentOverview,this.showMonthlyPaymentOverview&&this.getListMonthlyPaymentOverview()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(f),t.Y36(m.F0),t.Y36(m.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-payments-list"]],decls:20,vars:4,consts:[[1,"row","page-titles","mx-0"],[1,"col-sm-6","p-md-0"],[1,"welcome-text"],[1,"mb-1"],[1,"col-sm-6","p-md-0","justify-content-sm-end","mt-2","mt-sm-0","d-flex"],["type","button",1,"btn","btn-success","btn-sl-sm","mr-3",3,"click"],[1,"mr-2"],[1,"fa","fa-plus"],["type","button",1,"btn","btn-primary","btn-sl-sm","mr-3",3,"click"],["class","row",4,"ngIf"],[3,"showLoader"],[1,"row"],[1,"col-lg-3","col-sm-6"],[1,"card"],[1,"stat-widget-two","card-body"],[1,"stat-content"],[1,"stat-text"],[1,"stat-digit"],[1,"fa","fa-money"],[1,"progress"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-success","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-primary","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-warning","w-100"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-danger","w-100"],[1,"col-12"],[1,"card-body"],[2,"width","100%","height","100%"],[3,"rowData","idTable","deleteRow"],[1,"card-header"],[1,"card-title"],[1,"card-body",2,"overflow","scroll"],[1,"table","table-striped","table-hover"],[1,"thead-dark"],[2,"text-align","center"],[4,"ngFor","ngForOf"],[3,"style",4,"ngFor","ngForOf"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),t._uU(4,"Pagos"),t.qZA(),t.TgZ(5,"p",3),t._uU(6,"Pagos Registrados"),t.qZA()()(),t.TgZ(7,"div",4)(8,"button",5),t.NdJ("click",function(){return n.toggleTable()}),t.TgZ(9,"span",6),t._UZ(10,"i",7),t.qZA(),t._uU(11," pagos mensuales"),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){return n.goToAdd()}),t.TgZ(13,"span",6),t._UZ(14,"i",7),t.qZA(),t._uU(15," Nuevo registro"),t.qZA()()(),t.YNc(16,P,45,4,"div",9),t.YNc(17,C,6,2,"div",9),t.YNc(18,w,38,1,"div",9),t._UZ(19,"app-loader",10)),2&e&&(t.xp6(16),t.Q6J("ngIf",!n.showMonthlyPaymentOverview),t.xp6(1),t.Q6J("ngIf",!n.showMonthlyPaymentOverview),t.xp6(1),t.Q6J("ngIf",n.showMonthlyPaymentOverview),t.xp6(1),t.Q6J("showLoader",n.showLoader))},dependencies:[c.sg,c.O5,b.x,v.R]}),o})();var p=l(7036),r=l(8765),I=l(8617);const x=["discountInput"];function D(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"button",63),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.deletePayment())}),t.TgZ(1,"span",64),t._UZ(2,"i",65),t.qZA(),t._uU(3," Eliminar"),t.qZA()}}function S(o,i){if(1&o&&(t.TgZ(0,"option",66),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Q6J("value",e.UUID),t.xp6(1),t.Oqu(e.Name)}}function N(o,i){if(1&o&&(t.TgZ(0,"option",66),t._uU(1),t.qZA()),2&o){const e=i.$implicit;t.Q6J("value",e.IdMonth),t.xp6(1),t.Oqu(e.Name)}}function M(o,i){if(1&o&&(t.TgZ(0,"div",15)(1,"label",67),t._uU(2,"Mes a pagar"),t.qZA(),t.TgZ(3,"select",68)(4,"option",69),t._uU(5,"Elegir..."),t.qZA(),t.YNc(6,N,2,2,"option",19),t.qZA(),t.TgZ(7,"div",20),t._uU(8),t.qZA()()),2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.months),t.xp6(2),t.hij(" ",e.validatorOfInput("IdMonth")," ")}}function k(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"div",71)(1,"input",72),t.NdJ("change",function(a){const u=t.CHM(e).$implicit,h=t.oxw(2);return t.KtG(h.onCheckChange(a,u))}),t.qZA(),t.TgZ(2,"label",73),t._uU(3),t.qZA()()}if(2&o){const e=i.$implicit,n=t.oxw(2);t.xp6(1),t.s9C("id",e.UUID),t.Q6J("checked",n.validateCheck(e)),t.xp6(1),t.s9C("for",e.UUID),t.xp6(1),t.Oqu(e.Name)}}function O(o,i){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,k,4,4,"div",70),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.products)}}function L(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"div",71)(1,"input",72),t.NdJ("change",function(a){const u=t.CHM(e).$implicit,h=t.oxw(2);return t.KtG(h.onCheckChangeLevels(a,u))}),t.qZA(),t.TgZ(2,"label",73),t._uU(3),t.qZA()()}if(2&o){const e=i.$implicit,n=t.oxw(2);t.xp6(1),t.s9C("id",e.UUID),t.Q6J("checked",n.validateCheck(e)),t.xp6(1),t.s9C("for",e.UUID),t.xp6(1),t.Oqu(e.Name)}}function J(o,i){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,L,4,4,"div",70),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.levels)}}function F(o,i){if(1&o&&(t.TgZ(0,"div",8)(1,"div",74)(2,"label",75),t._uU(3,"Referencia"),t.qZA(),t._UZ(4,"input",76),t.TgZ(5,"small",33),t._uU(6,"Agregar referencia"),t.qZA(),t.TgZ(7,"div",20),t._uU(8),t.qZA()()()),2&o){const e=t.oxw();t.xp6(8),t.hij(" ",e.validatorOfInput("Reference")," ")}}function B(o,i){if(1&o&&(t.TgZ(0,"li",77)(1,"div")(2,"h6",78),t._uU(3),t.qZA(),t.TgZ(4,"small",33),t._uU(5),t.qZA()(),t.TgZ(6,"span",33),t._uU(7),t.qZA()()),2&o){const e=i.$implicit;t.xp6(3),t.Oqu(e.Name),t.xp6(2),t.Oqu(e.Description),t.xp6(2),t.Oqu(e.AmountString)}}function R(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"li",50)(1,"span")(2,"button",79),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.deleteDiscount())}),t._UZ(3,"i",80),t.qZA(),t._uU(4," Descuento (USD) "),t.qZA(),t.TgZ(5,"strong"),t._uU(6),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(6),t.hij("$",e.discount,"")}}function E(o,i){if(1&o&&(t.TgZ(0,"li",50)(1,"span"),t._uU(2,"Resta pagar (USD)"),t.qZA(),t.TgZ(3,"strong"),t._uU(4),t.qZA()()),2&o){const e=t.oxw();t.xp6(4),t.hij("-$",e.pendingAmount,"")}}let _=(()=>{class o{constructor(e,n,a,s){this._service=e,this.router=n,this.route=a,this.alert=s,this.formHasBeenSave=!1,this.showLoader=!0,this.disableForm=!1,this.uuid=null,this.viewType="add",this.btnlabel="Agregar",this.studentsSelect=[],this.paymentDetail=[],this.products=[],this.levels=[],this.months=[],this.discount=0,this.totalUSD=0,this.PaymentDescription="",this.productsOnPayments=[],this.paymentMethod="",this.paymentType=null,this.LevelsOnPayments=[],this.pagoIncompleto=!1,this.pendingAmount=0,this.createForm(),this.subscribeChangeForm(),this.loadSelects()}ngOnInit(){this.showLoader=!0,this.route.params.subscribe(e=>{this.uuid=e.uuid,void 0!==this.uuid?(this.showLoader=!1,this.viewType="edit",this.loadPayment(),this.btnlabel="Guardar"):this.showLoader=!1})}loadSelects(){this.showLoader=!0,this._service.getResources().subscribe(e=>{let n=e;this.studentsSelect=n.students,this.products=n.products,this.levels=n.levels,this.months=n.months,this.showLoader=!1})}subscribeChangeForm(){this.formPayment.valueChanges.subscribe(e=>{this.formPayment.pristine||(this.formHasBeenSave=!1)})}loadPayment(){this.showLoader=!0,this._service.getPaymentsByUuid(this.uuid).subscribe(e=>{console.log(e),this.setFormPayment(e),this.showLoader=!1})}setFormPayment(e){this.formPayment.get("Amount").patchValue(e.Amount),this.formPayment.get("Currency").patchValue(e.Currency),this.formPayment.get("Student").patchValue(e.Student.UUID),this.formPayment.get("PaymentDate").patchValue(e.PaymentDate),this.formPayment.get("Observation").patchValue(e.Observation),this.formPayment.get("UUID").patchValue(e.UUID),this.formPayment.get("PaymentMethod").patchValue(e.PaymentMethod),this.formPayment.get("PaymentType").patchValue(e.PaymentType.toString()),this.formPayment.get("Reference").patchValue(e.Reference),this.formPayment.get("Create_at").patchValue(e.Create_at),this.formPayment.get("Description").patchValue(e.Description),this.formPayment.get("Status").patchValue(e.Status),e.Discount&&e.Discount.Amount&&(this.formPayment.get("Discount").patchValue(e.Discount.Amount),this.discount=e.Discount.Amount),this.paymentMethodEvaluate(e.PaymentMethod),this.paymentType=e.PaymentType.toString(),2==e.PaymentType?(this.formPayment.get("IdMonth").disable(),this.paymentDetail=e.products):(this.formPayment.get("IdMonth").patchValue(e.MonthlyPayment.IdMonth),this.formPayment.get("IdMonth").enable(),this.paymentDetail=e.levels),this.calculateTotals(),this.pendingAmountCheck(e.Amount)}createForm(){this.formPayment=new r.cw({Amount:new r.NI(0,[r.kI.required]),Currency:new r.NI(2),Student:new r.NI("",[r.kI.required]),PaymentDate:new r.NI(""),Observation:new r.NI(""),UUID:new r.NI(""),PaymentMethod:new r.NI("",[r.kI.required]),PaymentType:new r.NI(1,[r.kI.required]),Reference:new r.NI(""),Create_at:new r.NI(""),Description:new r.NI("",[r.kI.required]),Status:new r.NI(3,[r.kI.required]),IdMonth:new r.NI(null,[r.kI.required]),Discount:new r.NI(null)}),this.formPayment.controls.PaymentType.setValue("1"),this.paymentType=1}sendForm(){var e=this;return(0,p.Z)(function*(){if(e.formHasBeenSave=!0,e.disableForm=!0,e.formPayment.valid){e.showLoader=!0,e.formPayment.get("Status").enable();let n=e.formPayment.value,a={};a.payment=n,e.discount&&(a.discount=n.Discount),1==n.PaymentType?a.levels=e.paymentDetail:2==n.PaymentType&&(a.products=e.paymentDetail),"add"==e.viewType?e._service.addPayment(a).subscribe(function(){var s=(0,p.Z)(function*(u){e.alert.success("Registro Creado","Se ha creado el registro"),e.goBack()});return function(u){return s.apply(this,arguments)}}(),s=>{console.log(s),e.disableForm=!1,e.showLoader=!1}):(e.alert.success("Registro Actualizado","Se ha actualizado el registro"),e._service.updPayment(a).subscribe(function(){var s=(0,p.Z)(function*(u){e.formPayment.get("Status").disable(),e.showLoader=!1});return function(u){return s.apply(this,arguments)}}(),s=>{console.log(s),e.disableForm=!1,e.showLoader=!1}))}else e.alert.warning("Campos invalidos","Verifique los campos marcados")})()}deletePayment(){y().fire({title:"Cuidado",text:"\xbfDesea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar!",cancelButtonText:"Cancelar"}).then(e=>{console.log(e),e.isConfirmed&&this._service.delPayment({uuid:this.uuid}).subscribe(n=>{this.goBack()})})}goBack(){this.router.navigate(["admin/payments"])}validateCheck(e){let n=null;return n=this.paymentDetail.find(a=>a.UUID==e.UUID),!!n}onChangeStudent(){this.showLoader=!0,this._service.getLevelsbyStudents(this.formPayment.get("Student").value).subscribe(e=>{let n=e;this.paymentDetail=[],n.forEach(a=>{let s=this.levels.find(u=>u.UUID==a.UUID);this.paymentDetail.push(s),this.calculateTotals()}),this.showLoader=!1})}onCheckChange(e,n){console.log(n),e.target.checked?this.paymentDetail.push(n):this.paymentDetail=this.paymentDetail.filter(a=>a.UUID!=n.UUID),this.calculateTotals()}onRadioChange(e){this.paymentMethodEvaluate(e.target.value)}paymentMethodEvaluate(e){this.paymentMethod=e,"electronic"==this.paymentMethod?this.formPayment.get("Reference").enable():this.formPayment.get("Reference").disable()}onRadioChangeLevels(e){this.paymentType=e.target.value,this.paymentDetail=[],2==this.paymentType?this.formPayment.get("IdMonth").disable():this.formPayment.get("IdMonth").enable()}onCheckChangeLevels(e,n){e.target.checked?this.paymentDetail.push(n):this.paymentDetail=this.paymentDetail.filter(a=>a.UUID!=n.UUID),this.calculateTotals(),this.pendingAmountCheck()}calculateTotals(){this.discount>this.totalUSD&&this.deleteDiscount(),this.totalUSD=this.paymentDetail.reduce((e,n)=>e+n.Amount,0)-this.discount,this.PaymentDescription=this.paymentDetail.reduce((e,n)=>e+" | "+n.Description,""),this.PaymentDescription=this.PaymentDescription.slice(0,99),this.formPayment.get("Description").patchValue(this.PaymentDescription)}validatorOfInput(e){let s,n=this.formPayment.get(e);if(!(n.touched&&n.invalid||this.formHasBeenSave&&n.invalid))return"";if(n.errors.required)return s="Campo Requerido.",s;if(n.errors.pattern)return s="El formato no es valido",s;if(n.errors.minlength)return s=`Debe contener al menos ${n.errors.minlength.requiredLength} caracteres`,s;if(n.errors.maxlength){let h=n.value.substring(0,n.value.length-1);n.patchValue(h)}}checkTotalStatus(e){console.log(e.target.value),this.formPayment.get("Status").disable(),this.totalUSD>e.target.value?(this.pendingAmount=this.totalUSD-parseFloat(e.target.value),this.pagoIncompleto=!0,this.formPayment.get("Status").patchValue(2)):this.totalUSD==e.target.value&&(this.formPayment.get("Status").patchValue(3),this.pagoIncompleto=!1)}pendingAmountCheck(e=null){null==e&&(e=this.formPayment.get("Amount").value),this.totalUSD>e?(this.pendingAmount=this.totalUSD-e,this.pagoIncompleto=!0,this.formPayment.get("Status").patchValue(2),this.formPayment.get("Status").disable()):(this.pagoIncompleto=!1,this.formPayment.get("Status").patchValue(3),this.formPayment.get("Status").enable())}addDiscount(){let e=parseFloat(this.discountInput.nativeElement.value);if(e<=this.totalUSD){this.discount=e,this.formPayment.get("Discount").patchValue(e),this.calculateTotals();let n=this.formPayment.get("Amount").value;this.pendingAmountCheck(n),this.alert.success("Exito","Descuento agregado")}else this.alert.error("Error","El monto del descuento no puede ser mayor al total")}deleteDiscount(){this._service.deleteDiscount({uuid:this.uuid}).subscribe(e=>{this.discount=0,this.calculateTotals();let n=this.formPayment.get("Amount").value;this.pendingAmountCheck(n),this.alert.warning("Alerta","Descuento Eliminado")})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(f),t.Y36(m.F0),t.Y36(m.gz),t.Y36(I.c))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-payment-crud"]],viewQuery:function(e,n){if(1&e&&t.Gf(x,7),2&e){let a;t.iGM(a=t.CRH())&&(n.discountInput=a.first)}},decls:128,vars:20,consts:[[1,"row","page-titles","mx-0"],[1,"col-sm-6","p-md-0"],[1,"welcome-text"],[1,"mb-1"],[1,"col-sm-6","p-md-0","justify-content-sm-end","mt-2","mt-sm-0","d-flex"],["class","btn btn-danger btn-sl-sm mr-3","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-warning",3,"click"],["novalidate","",1,"needs-validation",3,"formGroup"],[1,"row"],[1,"col-lg-8"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"col-md-12","order-md-1"],[1,"mb-3"],["for","Student"],["id","Student","required","","formControlName","Student",1,"custom-select","d-block","w-100",3,"change"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"invalid-feedback"],[1,"mb-4"],[1,"d-block","my-3"],[1,"custom-control","custom-radio"],["formControlName","PaymentType","id","levels","name","PaymentType","type","radio","value","1","required","",1,"custom-control-input",3,"change"],["for","levels",1,"custom-control-label"],["formControlName","PaymentType","id","products","name","PaymentType","type","radio","value","2","required","",1,"custom-control-input",3,"change"],["for","products",1,"custom-control-label"],["id","Student","required","","formControlName","Status",1,"custom-select","d-block","w-100","disabled"],["value","1"],["value","2"],["value","3"],["for","PaymentDate"],[1,"text-muted"],["type","date","id","PaymentDate","formControlName","PaymentDate","placeholder","dd/mm/yyyy",1,"form-control"],["class","mb-3",4,"ngIf"],[1,"row","ml-2"],[4,"ngIf"],["formControlName","PaymentMethod","id","credit","name","PaymentMethod","type","radio","checked","","value","POS","required","",1,"custom-control-input",3,"change"],["for","credit",1,"custom-control-label"],["formControlName","PaymentMethod","id","debit","name","PaymentMethod","type","radio","value","cash","required","",1,"custom-control-input",3,"change"],["for","debit",1,"custom-control-label"],["formControlName","PaymentMethod","id","movil","name","PaymentMethod","type","radio","value","electronic","required","",1,"custom-control-input",3,"change"],["for","movil",1,"custom-control-label"],["class","row",4,"ngIf"],[1,"col-md-4","col-lg-4","order-md-2","mb-4"],[1,"paymentDetailContainer"],[1,"list-group","mb-3"],["class","list-group-item d-flex justify-content-between lh-condensed",4,"ngFor","ngForOf"],["class","list-group-item d-flex justify-content-between",4,"ngIf"],[1,"list-group-item","d-flex","justify-content-between"],[1,"input-group"],["type","number","min","0","formControlName","Amount","placeholder","$0",1,"form-control",3,"keyup"],["type","number","min","0","placeholder","Descuento en USD",1,"form-control",3,"max"],["discountInput",""],[1,"input-group-append"],["type","submit",1,"btn","btn-secondary",3,"click"],[1,"col-lg-12"],[1,"card","mb-4"],[1,""],[1,"col","d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"showLoader"],["type","button",1,"btn","btn-danger","btn-sl-sm","mr-3",3,"click"],[1,"mr-2"],[1,"fa","fa-trash"],[3,"value"],["for","IdMonth"],["id","IdMonth","required","","formControlName","IdMonth",1,"custom-select","d-block","w-100"],["value","0","selected",""],["class","custom-control custom-checkbox col-md-6 col-md-lg col-sm-12",4,"ngFor","ngForOf"],[1,"custom-control","custom-checkbox","col-md-6","col-md-lg","col-sm-12"],["type","checkbox",1,"custom-control-input",3,"id","checked","change"],[1,"custom-control-label",3,"for"],[1,"col-md-12","mb-3"],["for","cc-name"],["type","text","id","cc-name","formControlName","Reference","placeholder","","required","",1,"form-control"],[1,"list-group-item","d-flex","justify-content-between","lh-condensed"],[1,"my-0"],["type","button",1,"btn",3,"click"],[1,"fa","fa-trash",2,"color","red"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),t._uU(4,"Pagos"),t.qZA(),t.TgZ(5,"p",3),t._uU(6,"nuevo registro"),t.qZA()()(),t.TgZ(7,"div",4),t.YNc(8,D,4,0,"button",5),t.TgZ(9,"button",6),t.NdJ("click",function(){return n.goBack()}),t._uU(10),t.qZA()()(),t.TgZ(11,"form",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"h4",12),t._uU(17,"Informacion de pago"),t.qZA()(),t.TgZ(18,"div",13)(19,"div",14)(20,"div",15)(21,"label",16),t._uU(22,"Estudiante"),t.qZA(),t.TgZ(23,"select",17),t.NdJ("change",function(){return n.onChangeStudent()}),t.TgZ(24,"option",18),t._uU(25,"Elegir..."),t.qZA(),t.YNc(26,S,2,2,"option",19),t.qZA(),t.TgZ(27,"div",20),t._uU(28),t.qZA()(),t._UZ(29,"hr",21),t.TgZ(30,"h4",15),t._uU(31,"Tipo de pago"),t.qZA(),t.TgZ(32,"div",22)(33,"div",23)(34,"input",24),t.NdJ("change",function(s){return n.onRadioChangeLevels(s)}),t.qZA(),t.TgZ(35,"label",25),t._uU(36,"Pago por niveles"),t.qZA()(),t.TgZ(37,"div",23)(38,"input",26),t.NdJ("change",function(s){return n.onRadioChangeLevels(s)}),t.qZA(),t.TgZ(39,"label",27),t._uU(40,"Otros"),t.qZA()(),t.TgZ(41,"div",20),t._uU(42),t.qZA()(),t.TgZ(43,"div",15)(44,"label",16),t._uU(45,"Estatus"),t.qZA(),t.TgZ(46,"select",28)(47,"option",18),t._uU(48,"Elegir..."),t.qZA(),t.TgZ(49,"option",29),t._uU(50,"Pendiente"),t.qZA(),t.TgZ(51,"option",30),t._uU(52,"Abonado"),t.qZA(),t.TgZ(53,"option",31),t._uU(54,"Completado"),t.qZA()(),t.TgZ(55,"div",20),t._uU(56),t.qZA()(),t.TgZ(57,"div",15)(58,"label",32),t._uU(59,"Fecha de Pago "),t.TgZ(60,"span",33),t._uU(61,"(Opcional)"),t.qZA()(),t._UZ(62,"input",34),t.qZA(),t.YNc(63,M,9,2,"div",35),t._UZ(64,"hr",21),t.TgZ(65,"h4",15),t._uU(66,"Descripcion de pago"),t.qZA(),t.TgZ(67,"div",36),t.YNc(68,O,2,1,"div",37),t.YNc(69,J,2,1,"div",37),t.TgZ(70,"div",20),t._uU(71),t.qZA()(),t._UZ(72,"hr",21),t.TgZ(73,"h4",15),t._uU(74,"Metodo de pago"),t.qZA(),t.TgZ(75,"div",22)(76,"div",23)(77,"input",38),t.NdJ("change",function(s){return n.onRadioChange(s)}),t.qZA(),t.TgZ(78,"label",39),t._uU(79,"Punto de venta"),t.qZA()(),t.TgZ(80,"div",23)(81,"input",40),t.NdJ("change",function(s){return n.onRadioChange(s)}),t.qZA(),t.TgZ(82,"label",41),t._uU(83,"Efectivo"),t.qZA()(),t.TgZ(84,"div",23)(85,"input",42),t.NdJ("change",function(s){return n.onRadioChange(s)}),t.qZA(),t.TgZ(86,"label",43),t._uU(87,"Trasferencia / Pago movil"),t.qZA()(),t.TgZ(88,"div",20),t._uU(89),t.qZA()(),t.YNc(90,F,9,1,"div",44),t.qZA()(),t._UZ(91,"hr",21),t.qZA()(),t.TgZ(92,"div",45)(93,"div",10)(94,"div",11)(95,"h4",12),t._uU(96,"Detalle de pago"),t.qZA()(),t.TgZ(97,"div",13)(98,"div",46)(99,"ul",47),t.YNc(100,B,8,3,"li",48),t.YNc(101,R,7,1,"li",49),t.TgZ(102,"li",50)(103,"span"),t._uU(104,"Total a pagar (USD)"),t.qZA(),t.TgZ(105,"strong"),t._uU(106),t.qZA()(),t.YNc(107,E,5,1,"li",49),t.TgZ(108,"li",50)(109,"span"),t._uU(110,"Total (USD)"),t.qZA(),t.TgZ(111,"div",51)(112,"input",52),t.NdJ("keyup",function(s){return n.checkTotalStatus(s)}),t.qZA()()()()(),t.TgZ(113,"div",51),t._UZ(114,"input",53,54),t.TgZ(116,"div",55)(117,"button",56),t.NdJ("click",function(){return n.addDiscount()}),t._uU(118,"Agregar"),t.qZA()()()()()()(),t.TgZ(119,"div",8)(120,"div",57)(121,"div",58)(122,"div",13)(123,"div",59)(124,"div",60)(125,"button",61),t.NdJ("click",function(){return n.sendForm()}),t._uU(126),t.qZA()()()()()()()(),t._UZ(127,"app-loader",62)),2&e&&(t.xp6(8),t.Q6J("ngIf","edit"==n.viewType),t.xp6(2),t.Oqu("salir"),t.xp6(1),t.Q6J("formGroup",n.formPayment),t.xp6(15),t.Q6J("ngForOf",n.studentsSelect),t.xp6(2),t.hij(" ",n.validatorOfInput("Student")," "),t.xp6(14),t.hij(" ",n.validatorOfInput("PaymentType")," "),t.xp6(14),t.hij(" ",n.validatorOfInput("Status")," "),t.xp6(7),t.Q6J("ngIf",1==n.paymentType),t.xp6(5),t.Q6J("ngIf",2==n.paymentType),t.xp6(1),t.Q6J("ngIf",1==n.paymentType),t.xp6(2),t.hij(" ",n.validatorOfInput("Description")," "),t.xp6(18),t.hij(" ",n.validatorOfInput("PaymentMethod")," "),t.xp6(1),t.Q6J("ngIf","electronic"==n.paymentMethod),t.xp6(10),t.Q6J("ngForOf",n.paymentDetail),t.xp6(1),t.Q6J("ngIf",n.discount),t.xp6(5),t.hij("$",n.totalUSD,""),t.xp6(1),t.Q6J("ngIf",n.pagoIncompleto&&n.pendingAmount>0),t.xp6(7),t.s9C("max",n.totalUSD),t.xp6(12),t.Oqu(n.btnlabel),t.xp6(1),t.Q6J("showLoader",n.showLoader))},dependencies:[c.sg,c.O5,v.R,r._Y,r.YN,r.Kr,r.Fj,r.wV,r.EJ,r._,r.JJ,r.JL,r.Q7,r.qQ,r.sg,r.u],styles:[".paymentDetailContainer[_ngcontent-%COMP%]{max-height:90vh;overflow:auto}"]}),o})();const Q=[{path:"",component:q},{path:"new",component:_},{path:"update/:uuid",component:_}];let Y=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.Bz.forChild(Q),m.Bz]}),o})();var V=l(2795);let j=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[c.ez,V.m,Y,r.UX]}),o})()}}]);